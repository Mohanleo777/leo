<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Location and Picture</title>
</head>
<body>

    <h2>Welcome! Please allow access to your location and camera.</h2>

    <!-- Location and Picture Capture -->
    <div id="status"></div>
    <div id="camera">
        <video id="video" width="320" height="240" autoplay></video>
        <button id="captureButton">Capture Picture</button>
        <canvas id="canvas" style="display: none;"></canvas>
    </div>

    <script>
        // Function to capture location
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const location = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    console.log('Location:', location);
                    // You can send the location to a server using an AJAX call
                    sendDataToServer(location, null);  // Placeholder for picture
                }, (error) => {
                    document.getElementById('status').innerText = 'Error getting location.';
                });
            } else {
                document.getElementById('status').innerText = 'Geolocation is not supported by this browser.';
            }
        }

        // Function to start the camera
        function startCamera() {
            const video = document.getElementById("video");
            const captureButton = document.getElementById("captureButton");
            const canvas = document.getElementById("canvas");

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then((stream) => {
                        video.srcObject = stream;
                    })
                    .catch((err) => {
                        console.error("Error accessing camera:", err);
                        document.getElementById('status').innerText = 'Error accessing camera.';
                    });

                captureButton.addEventListener('click', () => {
                    const context = canvas.getContext('2d');
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const imageData = canvas.toDataURL('image/png');
                    console.log('Captured Image:', imageData);

                    // Send the captured image and location data to the server
                    getLocation(); // Get location after the picture is captured
                    sendDataToServer(null, imageData);  // Send image after location
                });
            } else {
                console.error("Camera not supported.");
                document.getElementById('status').innerText = 'Camera not supported.';
            }
        }

        // Function to send data to the server
        function sendDataToServer(location, imageData) {
            const data = {
                location: location,
                image: imageData
            };

            // Example AJAX call to send data to the server
            fetch('your-server-endpoint', {  // Replace with your server endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data sent successfully:', data);
            })
            .catch((error) => {
                console.error('Error sending data:', error);
            });
        }

        // Initialize the camera when the page loads
        window.onload = function() {
            startCamera();
        };
    </script>

</body>
</html>
